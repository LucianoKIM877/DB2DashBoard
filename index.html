<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025ë…„ë„ êµ­íšŒë„ì„œê´€ ì›ë¬¸DB êµ¬ì¶•ì‚¬ì—… ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            -webkit-user-select: none;
            -moz-user-select: none;    
            -ms-user-select: none;     
            user-select: none;         
        }
        
        /* íŠ¹ê·¼ */
        .status-special {
            background: #e3fcef;
            color: #087f5b;
        }

        /* ì•¼ê·¼ */
        .status-overtime {
            background: #e7f0ff;
            color: #1c4ce0;
        }

        /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(2px);
        }

        .loading-content {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #667eea;
            font-size: 18px;
            font-weight: bold;
        }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header h2 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .sidebar-time {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .menu-item.active {
            background: rgba(255,255,255,0.2);
            border-left: 4px solid white;
        }
        
        .submenu {
            background: rgba(0,0,0,0.1);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .submenu.show {
            max-height: 400px;
        }
        
        .submenu-item {
            padding: 12px 20px 12px 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .submenu-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .submenu-item.active {
            background: rgba(255,255,255,0.15);
            border-left: 3px solid white;
        }
        
        .arrow {
            transition: transform 0.3s;
            font-size: 12px;
        }
        
        .arrow.down {
            transform: rotate(90deg);
        }
        
        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 20px;
        }
        
        .content-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .content-header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .content-header p {
            color: #666;
            font-size: 16px;
        }
        
        /* í˜ì´ì§€ ì„¹ì…˜ */
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #555;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .status-leave {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-half {
            background: #fff3cd;
            color: #856404;
        }
        
        /* íŒ€ë³„ ì‘ì—… í˜„í™© ê·¸ë¦¬ë“œ */
        .work-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .team-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .team-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .team-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .team-count {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .work-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .work-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .work-item h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .work-item p {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }
        
        .serial-number {
            color: #0066cc;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        /* í†µê³„ ì¹´ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-card .number {
            color: #667eea;
            font-size: 32px;
            font-weight: bold;
        }

        /* ì—ëŸ¬ ë©”ì‹œì§€ */
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        /* ì„±ê³µ ë©”ì‹œì§€ */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }

        /* ê³µì • ì™„ë£Œ ìƒíƒœ í‘œì‹œ */
        .project-complete {
            background: #e8f4f8;
            border: 2px solid #bee5eb;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .project-complete h3 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .project-complete p {
            color: #0c5460;
            margin: 5px 0;
        }

        /* ë¹ˆ ìƒíƒœ í‘œì‹œ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #666;
        }

        .empty-state p {
            color: #999;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content {
                margin-left: 200px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>2025ë…„ë„ êµ­íšŒë„ì„œê´€<br>ì›ë¬¸DB êµ¬ì¶•ì‚¬ì—… DBâ…¡</h2>
            <div class="sidebar-time" id="sidebarTime"></div>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-item active" onclick="showPage('workers')">
                <span>ì‘ì—…ì í˜„í™©</span>
            </div>
            
            <div class="menu-item" onclick="showPage('attendance')">
                <span>ì¶œí‡´ê·¼ í˜„í™©</span>
            </div>
            
            <div class="menu-item" onclick="toggleSubmenu(this)">
                <span>ì‘ì—… í˜„í™©</span>
                <span class="arrow">â–¶</span>
            </div>
            <div class="submenu" id="workSubmenu">
                <div class="submenu-item" onclick="showWorkTeam('all')">ì „ì²´ í˜„í™©</div>
                <div class="submenu-item" onclick="showWorkTeam('management')">ì‚¬ì—…ê´€ë¦¬íŒ€</div>
                <div class="submenu-item" onclick="showWorkTeam('scan')">ìŠ¤ìº”íŒ€</div>
                <div class="submenu-item" onclick="showWorkTeam('image')">ì´ë¯¸ì§€ë³´ì •íŒ€</div>
                <div class="submenu-item" onclick="showWorkTeam('toc')">TOCíŒ€</div>
                <div class="submenu-item" onclick="showWorkTeam('check1')">ì ê²€1íŒ€</div>
                <div class="submenu-item" onclick="showWorkTeam('check2')">ì ê²€2íŒ€</div>
                <div class="submenu-item" onclick="showWorkTeam('check3')">ì ê²€3íŒ€</div>
            </div>
        </div>
    </div>
    
    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="main-content">
        <!-- ì‘ì—…ì í˜„í™© í˜ì´ì§€ -->
        <div id="workersPage" class="page-section active">
            <div class="content-header">
                <h1>ì‘ì—…ì í˜„í™©</h1>
                <p>ì „ì²´ ì‘ì—…ì ëª©ë¡ ë° ìƒíƒœ</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>ì „ì²´ ì‘ì—…ì</h3>
                    <div class="number" id="totalWorkers">0</div>
                </div>
                <div class="stat-card">
                    <h3>í˜„ì¬ ê·¼ë¬´ì¤‘</h3>
                    <div class="number" id="workingCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>íœ´ê°€/ë°˜ì°¨</h3>
                    <div class="number" id="leaveCount">0</div>
                </div>
            </div>
            
            <div class="card">
                <h2>ì‘ì—…ì ëª©ë¡</h2>
                <div id="workersTableContainer">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>
        </div>
        
        <!-- ì¶œí‡´ê·¼ í˜„í™© í˜ì´ì§€ -->
        <div id="attendancePage" class="page-section">
            <div class="content-header">
                <h1>ì¶œí‡´ê·¼ í˜„í™©</h1>
                <p>ì˜¤ëŠ˜ì˜ ì¶œí‡´ê·¼ ê¸°ë¡</p>
            </div>
            
            <div class="card">
                <h2>ì¶œí‡´ê·¼ ê¸°ë¡</h2>
                <div id="attendanceTableContainer">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>
        </div>
        
        <!-- ì‘ì—… í˜„í™© í˜ì´ì§€ -->
        <div id="workPage" class="page-section">
            <div class="content-header">
                <h1 id="workPageTitle">ì „ì²´ ì‘ì—… í˜„í™©</h1>
                <p id="workPageDesc">ëª¨ë“  íŒ€ì˜ ì‘ì—… ì§„í–‰ ìƒí™©</p>
            </div>
            
            <div class="card">
                <div id="workStatusContainer">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ì„¤ì • ì¤‘ì•™í™”
        const CONFIG = {
            sheetId: "1gX0iaVZoVqVqdJDNwFE6l9owMOivGOq3FYGegU9qfrc",
            apiKey: "AIzaSyAEjtq3ThzW2QykAVjb-kXT274afMijZ8E",
            refreshInterval: 60000, // 1ë¶„
            maxRetries: 3,
            retryDelay: 1000,
            holidays: ["2025-10-03","2025-10-06","2025-10-07","2025-10-08","2025-10-09","2025-12-25"]
        };

        // ì „ì—­ ë³€ìˆ˜
        let workers = [];
        let leaveStatus = {};
        let workQueues = {
            'ì‚¬ì—…ê´€ë¦¬íŒ€': [],
            'ìŠ¤ìº”íŒ€': [],
            'ì´ë¯¸ì§€ë³´ì •íŒ€': [],
            'TOCíŒ€': [],
            'ì ê²€1íŒ€': [],
            'ì ê²€2íŒ€': [],
            'ì ê²€3íŒ€': []
        };
        let currentTeamView = 'all';
        let specialWork = {};
        let dataLoaded = false;
        let attendanceRecords = {};
        let lastDateCheck = formatDateLocal(new Date());
        let workerAssignments = {};
        
        // ë””ë°”ìš´ì‹±ì„ ìœ„í•œ íƒ€ì´ë¨¸
        let updateTimeout;
        
        // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œì–´
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            console.error(message);
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(message) {
            console.log(message);
        }
        
        // ë””ë°”ìš´ì‹±ëœ ì—…ë°ì´íŠ¸
        function debouncedUpdate() {
            if (updateTimeout) clearTimeout(updateTimeout);
            updateTimeout = setTimeout(() => {
                if (dataLoaded) {
                    updateWorkerTable();
                    updateAttendanceTable();
                    updateWorkStatus();
                }
            }, 100);
        }
        
        // ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.getElementById('sidebarTime').textContent = timeString;
            
            checkDateChange();
        }

        // ë‚ ì§œ ë³€ê²½ ì²´í¬ í•¨ìˆ˜
        function checkDateChange() {
            const currentDate = formatDateLocal(new Date());
            if (currentDate !== lastDateCheck) {
                console.log(`ë‚ ì§œ ë³€ê²½ ê°ì§€: ${lastDateCheck} â†’ ${currentDate}`);
                
                // ì¶œí‡´ê·¼ ê¸°ë¡ ë° ì‘ì—… í• ë‹¹ ì´ˆê¸°í™”
                attendanceRecords = {};
                workerAssignments = {};
                lastDateCheck = currentDate;
                
                if (dataLoaded) {
                    debouncedUpdate();
                }
                
                console.log("ì´ˆê¸°í™” ì™„ë£Œ");
            }
        }

        // ë‚ ì§œ ì •ê·œí™” í•¨ìˆ˜
        function formatDateLocal(d) {
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${y}-${m}-${day}`;
        }

        function normalizeId(v) {
            return String(v || '').trim().toUpperCase();
        }

        function normalizeDateString(s) {
            let v = String(s || '').trim();
            if (!v) return null;
            
            if (/^\d{8}$/.test(v)) {
                v = v.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3');
            }
            v = v.replace(/[.\/]/g, '-');
            
            if (!/^\d{4}-\d{2}-\d{2}$/.test(v)) return null;
            
            return v;
        }

        // ì‘ì—…ìì˜ í˜„ì¬ ì‘ì—… ê°€ì ¸ì˜¤ê¸° (ì—°ì†ì„± ìœ ì§€)
        function getWorkerCurrentWork(worker) {
            if (worker.team === 'ì‚¬ì—…ê´€ë¦¬íŒ€' || worker.team === 'ìŠ¤ìº”íŒ€') {
                return null;
            }
            
            const teamQueue = (workQueues[worker.team] || []).filter(item => item && item.trim());
            
            if (teamQueue.length === 0) {
                delete workerAssignments[worker.id];
                return null;
            }
            
            if (workerAssignments[worker.id] && teamQueue.includes(workerAssignments[worker.id])) {
                return workerAssignments[worker.id];
            }
            
            const teamWorkers = workers.filter(w => 
                w.team === worker.team && isWorkerWorking(w)
            );
            
            const assignedNumbers = Object.values(workerAssignments).filter(num => teamQueue.includes(num));
            const availableNumbers = teamQueue.filter(num => !assignedNumbers.includes(num));
            
            if (availableNumbers.length === 0) {
                const workerIndex = teamWorkers.findIndex(w => w.id === worker.id);
                const assignedNumber = teamQueue[workerIndex % teamQueue.length];
                workerAssignments[worker.id] = assignedNumber;
                return assignedNumber;
            }
            
            const workerIndex = teamWorkers.findIndex(w => w.id === worker.id);
            const assignedNumber = availableNumbers[workerIndex % availableNumbers.length];
            workerAssignments[worker.id] = assignedNumber;
            return assignedNumber;
        }

        // ì‘ì—…ìê°€ ê·¼ë¬´ ì¤‘ì¸ì§€ í™•ì¸
        function isWorkerWorking(worker) {
            const attendance = generateAttendance(worker);
            return ['ì •ìƒ','íŠ¹ê·¼','ì•¼ê·¼'].includes(attendance.status);
        }
        
        // í˜ì´ì§€ ì „í™˜
        function showPage(pageName) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (pageName === 'workers') {
                document.getElementById('workersPage').classList.add('active');
                document.querySelectorAll('.menu-item')[0].classList.add('active');
            } else if (pageName === 'attendance') {
                document.getElementById('attendancePage').classList.add('active');
                document.querySelectorAll('.menu-item')[1].classList.add('active');
            }
        }
        
        // ì„œë¸Œë©”ë‰´ í† ê¸€
        function toggleSubmenu(menuItem) {
            const submenu = document.getElementById('workSubmenu');
            const arrow = menuItem.querySelector('.arrow');
            
            submenu.classList.toggle('show');
            arrow.classList.toggle('down');
            
            if (submenu.classList.contains('show')) {
                showWorkTeam('all');
            }
        }
        
        // íŒ€ë³„ ì‘ì—… í˜„í™© í‘œì‹œ
        function showWorkTeam(team) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('workPage').classList.add('active');
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.menu-item')[2].classList.add('active');
            
            document.querySelectorAll('.submenu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentTeamView = team;
            
            const titles = {
                'all': 'ì „ì²´ ì‘ì—… í˜„í™©',
                'management': 'ì‚¬ì—…ê´€ë¦¬íŒ€ ì‘ì—… í˜„í™©',
                'scan': 'ìŠ¤ìº”íŒ€ ì‘ì—… í˜„í™©',
                'image': 'ì´ë¯¸ì§€ë³´ì •íŒ€ ì‘ì—… í˜„í™©',
                'toc': 'TOCíŒ€ ì‘ì—… í˜„í™©',
                'check1': 'ì ê²€1íŒ€ ì‘ì—… í˜„í™©',
                'check2': 'ì ê²€2íŒ€ ì‘ì—… í˜„í™©',
                'check3': 'ì ê²€3íŒ€ ì‘ì—… í˜„í™©'
            };
            
            const descriptions = {
                'all': 'ëª¨ë“  íŒ€ì˜ ì‘ì—… ì§„í–‰ ìƒí™©',
                'management': 'ì‚¬ì—…ê´€ë¦¬íŒ€ ì‘ì—… ì§„í–‰ ìƒí™©',
                'scan': 'ìŠ¤ìº”íŒ€ ì‘ì—… ì§„í–‰ ìƒí™©',
                'image': 'ì´ë¯¸ì§€ë³´ì •íŒ€ ì‘ì—… ì§„í–‰ ìƒí™©',
                'toc': 'TOCíŒ€ ì‘ì—… ì§„í–‰ ìƒí™©',
                'check1': 'ì ê²€1íŒ€ ì‘ì—… ì§„í–‰ ìƒí™©',
                'check2': 'ì ê²€2íŒ€ ì‘ì—… ì§„í–‰ ìƒí™©',
                'check3': 'ì ê²€3íŒ€ ì‘ì—… ì§„í–‰ ìƒí™©'
            };
            
            document.getElementById('workPageTitle').textContent = titles[team];
            document.getElementById('workPageDesc').textContent = descriptions[team];
            
            updateWorkStatus();
        }
        
        // ì‹œë“œ ê¸°ë°˜ ì˜ì‚¬ëœë¤ ìƒì„±ê¸°
        function SeededRandom(seed) {
            this.seed = seed % 2147483647;
            if (this.seed <= 0) this.seed += 2147483646;
        }

        SeededRandom.prototype.next = function() {
            this.seed = this.seed * 16807 % 2147483647;
            return (this.seed - 1) / 2147483646;
        };

        function stringToSeed(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash);
        }

        // ëœë¤ ì‹œê°„ ìƒì„±
        function getRandomTime(startHour, startMin, endHour, endMin, workerId = 'default', date = new Date()) {
            const dateStr = formatDateLocal(date);
            const seedStr = `${workerId}_${dateStr}_${startHour}_${startMin}_${endHour}_${endMin}`;
            const seed = stringToSeed(seedStr);
            const rng = new SeededRandom(seed);
            
            const start = startHour * 60 + startMin;
            const end = endHour * 60 + endMin;
            const randomMin = Math.floor(rng.next() * (end - start + 1)) + start;
            const hour = Math.floor(randomMin / 60);
            const min = randomMin % 60;
            const sec = Math.floor(rng.next() * 60);
            
            return `${String(hour).padStart(2, '0')}:${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        }

        // ì¶œí‡´ê·¼ ì‹œê°„ ìƒì„± (ì‹¤ì‹œê°„ ë°˜ì˜)
        function generateAttendance(worker, date = new Date()) {
            const today = date;
            const todayStr = formatDateLocal(today);
            const wid = normalizeId(worker.id);
            const dayOfWeek = today.getDay();
            const currentHour = today.getHours();
            const currentMinute = today.getMinutes();
            const currentTime = currentHour * 60 + currentMinute;

            // ì£¼ë§/ê³µíœ´ì¼
            if (dayOfWeek === 0 || dayOfWeek === 6 || CONFIG.holidays.includes(todayStr)) {
                return { name: worker.name, team: worker.team, checkIn: '-', checkOut: '-', status: 'íœ´ë¬´' };
            }

            // ì—°ì°¨ / ë°˜ì°¨
            const leaveKey = `${wid}_${todayStr}`;
            const todayLeaveStatus = leaveStatus[leaveKey];
            
            if (todayLeaveStatus === 'ì—°ì°¨') {
                return { name: worker.name, team: worker.team, checkIn: 'ì—°ì°¨', checkOut: 'ì—°ì°¨', status: 'ì—°ì°¨' };
            }
            
            // ì¶œí‡´ê·¼ ê¸°ë¡ í‚¤
            const recordKey = `${wid}_${todayStr}`;
            
            if (!attendanceRecords[recordKey]) {
                attendanceRecords[recordKey] = {
                    checkInTime: null,
                    checkOutTime: null,
                    isWorkingHours: false
                };
            }
            
            const record = attendanceRecords[recordKey];
            
            if (todayLeaveStatus === 'ì˜¤ì „ë°˜ì°¨') {
                if (currentTime >= 13 * 60 + 30 && !record.checkInTime) {
                    record.checkInTime = getRandomTime(13, 30, 14, 0, wid, today);
                    record.isWorkingHours = true;
                }
                if (currentTime >= 18 * 60 && record.isWorkingHours && !record.checkOutTime) {
                    record.checkOutTime = getRandomTime(17, 50, 18, 10, wid, today);
                }
                
                return {
                    name: worker.name, team: worker.team,
                    checkIn: record.checkInTime || '-',
                    checkOut: record.checkOutTime || '-',
                    status: record.checkOutTime ? 'í‡´ê·¼' : (record.checkInTime ? 'ì •ìƒ' : 'ì˜¤ì „ë°˜ì°¨')
                };
            }
            
            if (todayLeaveStatus === 'ì˜¤í›„ë°˜ì°¨') {
                if (currentTime >= 8 * 60 + 30 && !record.checkInTime) {
                    record.checkInTime = getRandomTime(8, 30, 9, 0, wid, today);
                    record.isWorkingHours = true;
                }
                if (currentTime >= 14 * 60 && record.isWorkingHours && !record.checkOutTime) {
                    record.checkOutTime = getRandomTime(14, 0, 14, 10, wid, today);
                }
                
                return {
                    name: worker.name, team: worker.team,
                    checkIn: record.checkInTime || '-',
                    checkOut: record.checkOutTime || '-',
                    status: record.checkOutTime ? 'í‡´ê·¼' : (record.checkInTime ? 'ì •ìƒ' : 'ì˜¤í›„ë°˜ì°¨')
                };
            }

            // íŠ¹ê·¼ / ì•¼ê·¼
            const sw = specialWork[worker.id];
            if (sw) {
                if (sw.type === 'íŠ¹ê·¼') {
                    const [sh, sm] = sw.start.split(':').map(Number);
                    const [eh, em] = sw.end.split(':').map(Number);
                    const startTime = sh * 60 + sm;
                    const endTime = eh * 60 + em;

                    if (currentTime >= startTime && !record.checkInTime) {
                        record.checkInTime = getRandomTime(sh, sm - 30, sh, sm, wid, today);
                        record.isWorkingHours = true;
                    }
                    if (currentTime >= endTime && record.isWorkingHours && !record.checkOutTime) {
                        record.checkOutTime = getRandomTime(eh, em, eh, em + 10, wid, today);
                    }

                    return {
                        name: worker.name, team: worker.team,
                        checkIn: record.checkInTime || '-',
                        checkOut: record.checkOutTime || '-',
                        status: record.checkOutTime ? 'í‡´ê·¼' : (record.checkInTime ? 'íŠ¹ê·¼' : 'íŠ¹ê·¼ëŒ€ê¸°')
                    };
                }

                if (sw.type === 'ì•¼ê·¼') {
                    const [eh, em] = sw.end.split(':').map(Number);
                    const endTime = eh * 60 + em;
                    
                    if (currentTime >= 8 * 60 + 30 && !record.checkInTime) {
                        record.checkInTime = getRandomTime(8, 30, 9, 0, wid, today);
                        record.isWorkingHours = true;
                    }
                    if (currentTime >= endTime && record.isWorkingHours && !record.checkOutTime) {
                        record.checkOutTime = getRandomTime(eh, em, eh, em + 10, wid, today);
                    }

                    return {
                        name: worker.name, team: worker.team,
                        checkIn: record.checkInTime || '-',
                        checkOut: record.checkOutTime || '-',
                        status: record.checkOutTime ? 'í‡´ê·¼' : (record.checkInTime ? 'ì•¼ê·¼' : 'ì¶œê·¼ëŒ€ê¸°')
                    };
                }
            }

            // ê¸°ë³¸ ì •ìƒ ê·¼ë¬´
            if (currentTime >= 8 * 60 + 30 && !record.checkInTime) {
                record.checkInTime = getRandomTime(8, 30, 9, 0, wid, today);
                record.isWorkingHours = true;
            }
            
            if (currentTime >= 18 * 60 && record.isWorkingHours && !record.checkOutTime) {
                record.checkOutTime = getRandomTime(17, 50, 18, 10, wid, today);
            }

            return {
                name: worker.name,
                team: worker.team,
                checkIn: record.checkInTime || '-',
                checkOut: record.checkOutTime || '-',
                status: record.checkOutTime ? 'í‡´ê·¼' : (record.checkInTime ? 'ì •ìƒ' : 'ì¶œê·¼ëŒ€ê¸°')
            };
        }
        
        // ì‘ì—…ì í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateWorkerTable() {
            if (!dataLoaded) return;
            
            const container = document.getElementById('workersTableContainer');
            
            // ì‘ì—…ìê°€ ì—†ëŠ” ê²½ìš°
            if (workers.length === 0) {
                container.innerHTML = `
                    <div class="project-complete">
                        <h3>ğŸ‰ í”„ë¡œì íŠ¸ ì™„ë£Œ</h3>
                        <p>ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ì–´ ì‘ì—…ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!</p>
                    </div>
                `;
                document.getElementById('totalWorkers').textContent = '0';
                document.getElementById('workingCount').textContent = '0';
                document.getElementById('leaveCount').textContent = '0';
                return;
            }
            
            let workingCount = 0;
            let leaveCount = 0;
            
            const tableHtml = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>íŒ€</th>
                                <th>ID</th>
                                <th>ì´ë¦„</th>
                                <th>IP</th>
                                <th>ìƒíƒœ</th>
                                <th>í˜„ì¬ ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="workerTableBody">
                            <!-- ë™ì  ìƒì„± -->
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHtml;
            const tbody = document.getElementById('workerTableBody');

            workers.forEach(worker => {
                const attendance = generateAttendance(worker);
                
                if (attendance.status === 'ì—°ì°¨' || attendance.status === 'ì˜¤ì „ë°˜ì°¨' || attendance.status === 'ì˜¤í›„ë°˜ì°¨') {
                    leaveCount++;
                } else if (attendance.status !== 'í‡´ê·¼' && attendance.status !== 'íœ´ë¬´') {
                    workingCount++;
                }
                
                const currentWork = getWorkerCurrentWork(worker);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${worker.team}</td>
                    <td>${worker.id}</td>
                    <td>${worker.name}</td>
                    <td>${worker.ip}</td>
                    <td>${
                    attendance.status === 'ì—°ì°¨' ? '<span class="status-badge status-leave">ì—°ì°¨</span>' :
                    attendance.status === 'ì˜¤ì „ë°˜ì°¨' ? '<span class="status-badge status-half">ì˜¤ì „ë°˜ì°¨</span>' :
                    attendance.status === 'ì˜¤í›„ë°˜ì°¨' ? '<span class="status-badge status-half">ì˜¤í›„ë°˜ì°¨</span>' :
                    attendance.status === 'í‡´ê·¼' ? '<span style="color:#999;">í‡´ê·¼</span>' :
                    attendance.status === 'íœ´ë¬´' ? '<span style="color:#999;">íœ´ë¬´</span>' :
                    attendance.status === 'íŠ¹ê·¼' ? '<span class="status-badge status-special">íŠ¹ê·¼</span>' :
                    attendance.status === 'ì•¼ê·¼' ? '<span class="status-badge status-overtime">ì•¼ê·¼</span>' :
                    '<span style="color:#28a745;">ê·¼ë¬´ì¤‘</span>'
                    }</td>
                    <td>${
                        (worker.team === 'ì‚¬ì—…ê´€ë¦¬íŒ€' || worker.team === 'ìŠ¤ìº”íŒ€')
                            ? (attendance.status === 'ì—°ì°¨' || attendance.status === 'ì˜¤ì „ë°˜ì°¨' || 
                            attendance.status === 'ì˜¤í›„ë°˜ì°¨' || attendance.status === 'í‡´ê·¼' || 
                            attendance.status === 'íœ´ë¬´' || attendance.status === 'ì¶œê·¼ëŒ€ê¸°' ||
                            attendance.status === 'íŠ¹ê·¼ëŒ€ê¸°'
                            
                                ? '<span style="color: #999;">ëŒ€ê¸°ì¤‘</span>'
                                : '<span style="color: #28a745;">ì‘ì—…ì¤‘</span>')
                            : (currentWork 
                                ? `<span class="serial-number">${currentWork}</span>` 
                                : '<span style="color: #999;">ëŒ€ê¸°ì¤‘</span>')
                    }</td>
                `;
            });
            
            document.getElementById('totalWorkers').textContent = workers.length;
            document.getElementById('workingCount').textContent = workingCount;
            document.getElementById('leaveCount').textContent = leaveCount;
        }
        
        // ì¶œí‡´ê·¼ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateAttendanceTable() {
            if (!dataLoaded) return;
            
            const container = document.getElementById('attendanceTableContainer');
            
            // ì‘ì—…ìê°€ ì—†ëŠ” ê²½ìš°
            if (workers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“‹</div>
                        <h3>ì¶œí‡´ê·¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>í˜„ì¬ ë“±ë¡ëœ ì‘ì—…ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            const tableHtml = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>íŒ€</th>
                                <th>ì´ë¦„</th>
                                <th>ì¶œê·¼ ì‹œê°„</th>
                                <th>í‡´ê·¼ ì‹œê°„</th>
                                <th>ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <!-- ë™ì  ìƒì„± -->
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHtml;
            const tbody = document.getElementById('attendanceTableBody');
            
            workers.forEach(worker => {
                const attendance = generateAttendance(worker);
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${attendance.team}</td>
                    <td>${attendance.name}</td>
                    <td>${attendance.checkIn}</td>
                    <td>${attendance.checkOut}</td>
                    <td><span class="status-badge ${
                        attendance.status === 'ì—°ì°¨' ? 'status-leave' :
                        (attendance.status === 'ì˜¤ì „ë°˜ì°¨' || attendance.status === 'ì˜¤í›„ë°˜ì°¨') ? 'status-half' :
                        (attendance.status === 'íŠ¹ê·¼' ? 'status-special' :
                        attendance.status === 'ì•¼ê·¼' ? 'status-overtime' : '')
                    }">${attendance.status}</span></td>
                `;
            });
        }
        
        // ì‘ì—… í˜„í™© ì—…ë°ì´íŠ¸
        function updateWorkStatus() {
            if (!dataLoaded) return;
            
            const container = document.getElementById('workStatusContainer');
            
            // ì‘ì—…ìê°€ ì—†ëŠ” ê²½ìš°
            if (workers.length === 0) {
                container.innerHTML = `
                    <div class="project-complete">
                        <h3>ğŸ¯ ì‘ì—… ì™„ë£Œ</h3>
                        <p>ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        <p>í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            const teamMap = {
                'management': 'ì‚¬ì—…ê´€ë¦¬íŒ€',
                'scan': 'ìŠ¤ìº”íŒ€',
                'image': 'ì´ë¯¸ì§€ë³´ì •íŒ€',
                'toc': 'TOCíŒ€',
                'check1': 'ì ê²€1íŒ€',
                'check2': 'ì ê²€2íŒ€',
                'check3': 'ì ê²€3íŒ€'
            };
            
            if (currentTeamView === 'all') {
                const teamsToShow = ['ì‚¬ì—…ê´€ë¦¬íŒ€', 'ìŠ¤ìº”íŒ€', 'ì´ë¯¸ì§€ë³´ì •íŒ€', 'TOCíŒ€', 'ì ê²€1íŒ€', 'ì ê²€2íŒ€', 'ì ê²€3íŒ€'];
                let hasWorkingTeams = false;
                
                teamsToShow.forEach(teamName => {
                    const teamWorkers = workers.filter(w => w.team === teamName);
                    const workingWorkers = teamWorkers.filter(w => {
                        const attendance = generateAttendance(w);
                        return attendance.status !== 'ì—°ì°¨' && attendance.status !== 'í‡´ê·¼' && 
                            attendance.status !== 'ì˜¤ì „ë°˜ì°¨' && attendance.status !== 'ì˜¤í›„ë°˜ì°¨' && 
                            attendance.status !== 'íœ´ë¬´' && attendance.status !== 'ì¶œê·¼ëŒ€ê¸°' && 
                            attendance.status !== 'íŠ¹ê·¼ëŒ€ê¸°'
                    });
                    if (workingWorkers.length > 0) {
                        hasWorkingTeams = true;
                        const teamSection = document.createElement('div');
                        teamSection.className = 'team-section';
                        
                        const teamHeader = document.createElement('div');
                        teamHeader.className = 'team-header';
                        teamHeader.innerHTML = `
                            <div class="team-title">${teamName}</div>
                            <div class="team-count">${workingWorkers.length}ëª…</div>
                        `;
                        teamSection.appendChild(teamHeader);
                        
                        const teamGrid = document.createElement('div');
                        teamGrid.className = 'work-status-grid';
                        
                        workingWorkers.forEach(worker => {
                            const div = document.createElement('div');
                            div.className = 'work-item';
                            const currentWork = getWorkerCurrentWork(worker);
                            
                            if (teamName === 'ì‚¬ì—…ê´€ë¦¬íŒ€' || teamName === 'ìŠ¤ìº”íŒ€') {
                                const attendance = generateAttendance(worker);
                                div.innerHTML = `
                                    <h4>${worker.name} (${worker.id})</h4>
                                    <p><strong>IP:</strong> ${worker.ip}</p>
                                    <p><strong>ìƒíƒœ:</strong> ${
                                        attendance.status === 'ì—°ì°¨' || attendance.status === 'ì˜¤ì „ë°˜ì°¨' || 
                                        attendance.status === 'ì˜¤í›„ë°˜ì°¨' || attendance.status === 'í‡´ê·¼' || 
                                        attendance.status === 'íœ´ë¬´' || attendance.status === 'ì¶œê·¼ëŒ€ê¸°' ||
                                        attendance.status === 'íŠ¹ê·¼ëŒ€ê¸°'
                                            ? 'ëŒ€ê¸°ì¤‘'
                                            : 'ì‘ì—…ì¤‘'
                                    }</p>
                                `;
                            } else if (currentWork) {
                                div.innerHTML = `
                                    <h4>${worker.name} (${worker.id})</h4>
                                    <p><strong>IP:</strong> ${worker.ip}</p>
                                    <p><strong>ì‘ì—… ëŒ€ìƒ:</strong> <span class="serial-number">${currentWork}</span></p>
                                `;
                            } else {
                                div.innerHTML = `
                                    <h4>${worker.name} (${worker.id})</h4>
                                    <p><strong>IP:</strong> ${worker.ip}</p>
                                    <p><strong>ìƒíƒœ:</strong> ì‘ì—… ëŒ€ê¸°ì¤‘</p>
                                `;
                            }
                            teamGrid.appendChild(div);
                        });
                        
                        teamSection.appendChild(teamGrid);
                        container.appendChild(teamSection);
                    }
                });
                
                if (!hasWorkingTeams) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon">â°</div>
                            <h3>í˜„ì¬ ê·¼ë¬´ ì¤‘ì¸ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>ê·¼ë¬´ì‹œê°„ì´ ì•„ë‹ˆê±°ë‚˜ ëª¨ë“  ì‘ì—…ìê°€ íœ´ê°€/í‡´ê·¼ ìƒíƒœì…ë‹ˆë‹¤.</p>
                        </div>
                    `;
                }
            } else {
                const targetTeam = teamMap[currentTeamView];
                const teamWorkers = workers.filter(w => w.team === targetTeam);
                const workingWorkers = teamWorkers.filter(w => {
                    const attendance = generateAttendance(w);
                    return attendance.status !== 'ì—°ì°¨' && attendance.status !== 'í‡´ê·¼' && 
                        attendance.status !== 'ì˜¤ì „ë°˜ì°¨' && attendance.status !== 'ì˜¤í›„ë°˜ì°¨' && 
                        attendance.status !== 'íœ´ë¬´' && attendance.status !== 'ì¶œê·¼ëŒ€ê¸°' && 
                        attendance.status !== 'íŠ¹ê·¼ëŒ€ê¸°';
                });
                
                if (workingWorkers.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon">ğŸ‘¥</div>
                            <h3>${targetTeam} ê·¼ë¬´ìê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>í˜„ì¬ ì´ íŒ€ì—ëŠ” ê·¼ë¬´ ì¤‘ì¸ ì‘ì—…ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                    return;
                }
                
                const teamGrid = document.createElement('div');
                teamGrid.className = 'work-status-grid';
                
                workingWorkers.forEach(worker => {
                    const div = document.createElement('div');
                    div.className = 'work-item';
                    const currentWork = getWorkerCurrentWork(worker);
                    
                    if (targetTeam === 'ì‚¬ì—…ê´€ë¦¬íŒ€' || targetTeam === 'ìŠ¤ìº”íŒ€') {
                        const attendance = generateAttendance(worker);
                        div.innerHTML = `
                            <h4>${worker.name} (${worker.id})</h4>
                            <p><strong>IP:</strong> ${worker.ip}</p>
                            <p><strong>ìƒíƒœ:</strong> ${
                                attendance.status === 'ì—°ì°¨' || attendance.status === 'ì˜¤ì „ë°˜ì°¨' || 
                                attendance.status === 'ì˜¤í›„ë°˜ì°¨' || attendance.status === 'í‡´ê·¼' || 
                                attendance.status === 'íœ´ë¬´' || attendance.status === 'ì¶œê·¼ëŒ€ê¸°' ||
                                attendance.status === 'íŠ¹ê·¼ëŒ€ê¸°'
                                    ? 'ëŒ€ê¸°ì¤‘'
                                    : 'ì‘ì—…ì¤‘'
                            }</p>
                        `;
                    } else if (currentWork) {
                        div.innerHTML = `
                            <h4>${worker.name} (${worker.id})</h4>
                            <p><strong>IP:</strong> ${worker.ip}</p>
                            <p><strong>ìƒíƒœ:</strong> <span class="serial-number">${currentWork}</span></p>
                        `;
                    } else {
                        div.innerHTML = `
                            <h4>${worker.name} (${worker.id})</h4>
                            <p><strong>IP:</strong> ${worker.ip}</p>
                            <p><strong>ìƒíƒœ:</strong> ì‘ì—… ëŒ€ê¸°ì¤‘</p>
                        `;
                    }
                    teamGrid.appendChild(div);
                });
                
                container.appendChild(teamGrid);
            }
        }

        // ì¬ì‹œë„ ë¡œì§ì´ í¬í•¨ëœ êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ
        async function loadSheetData(range, retries = CONFIG.maxRetries) {
            for (let i = 0; i < retries; i++) {
                try {
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.sheetId}/values/${range}?key=${CONFIG.apiKey}`;
                    const res = await fetch(url);
                    
                    if (res.status === 429) {
                        // Rate limit ì—ëŸ¬
                        const waitTime = Math.pow(2, i) * 2000;
                        await new Promise(resolve => setTimeout(resolve, waitTime));
                        continue;
                    }
                    
                    if (!res.ok) {
                        throw new Error(`ì‹œíŠ¸ ì ‘ê·¼ ì‹¤íŒ¨ (${res.status}): ${res.statusText}`);
                    }
                    
                    const data = await res.json();
                    return data.values || [];
                } catch (error) {
                    showError(`ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ (${i + 1}/${retries}): ${error.message}`);
                    
                    if (i === retries - 1) {
                        throw new Error(`ìµœì¢… ì‹œë„ ì‹¤íŒ¨: ${error.message}`);
                    }
                    
                    // ì§€ìˆ˜ ë°±ì˜¤í”„ë¡œ ì¬ì‹œë„ ëŒ€ê¸°
                    await new Promise(resolve => 
                        setTimeout(resolve, CONFIG.retryDelay * Math.pow(2, i))
                    );
                }
            }
        }

        // ëª¨ë“  ë°ì´í„° ë¡œë“œ
        async function loadAllData() {
            try {
                showLoading();
                
                // ë³‘ë ¬ë¡œ ëª¨ë“  ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ
                const [workerRows, leaveRows, workRows, specialRows] = await Promise.all([
                    loadSheetData("ì¸ë ¥êµ¬ë¶„!A:D").catch(() => []),
                    loadSheetData("ì—°ì°¨!A:C").catch(() => []),
                    loadSheetData("ì‘ì—…ëŸ‰!A:F").catch(() => []),
                    loadSheetData("íŠ¹ê·¼ì•¼ê·¼ê´€ë¦¬!A:D").catch(() => [])
                ]);

                // 1. ì¸ë ¥êµ¬ë¶„ ì²˜ë¦¬
                workers = workerRows.slice(1).map(r => ({
                    team: (r[0] || "").trim(),
                    id: normalizeId(r[1]),
                    name: (r[2] || "").trim(),
                    ip: (r[3] || "").trim()
                })).filter(w => w.team && w.id && w.name && w.ip);

                // 2. ì—°ì°¨ ì²˜ë¦¬
                leaveStatus = {};
                if (leaveRows.length > 1) {
                    leaveRows.slice(1).forEach(r => {
                        const rawId = normalizeId(r[0]);
                        let normDate = null;
                        
                        if (r[1] instanceof Date) {
                            normDate = formatDateLocal(r[1]);
                        } else {
                            normDate = normalizeDateString(r[1]);
                        }
                        
                        const rawType = String(r[2] || '').trim();

                        if (!rawId || !normDate || !rawType) return;

                        const typeMap = { 
                            'ì—°ì°¨': 'ì—°ì°¨', 
                            'ì˜¤ì „': 'ì˜¤ì „ë°˜ì°¨', 
                            'ì˜¤ì „ë°˜ì°¨': 'ì˜¤ì „ë°˜ì°¨', 
                            'ì˜¤í›„': 'ì˜¤í›„ë°˜ì°¨', 
                            'ì˜¤í›„ë°˜ì°¨': 'ì˜¤í›„ë°˜ì°¨' 
                        };
                        const type = typeMap[rawType] || rawType;

                        leaveStatus[`${rawId}_${normDate}`] = type;
                    });
                }

                // 3. ì‘ì—…ëŸ‰ ì²˜ë¦¬
                workQueues = {
                    'ì‚¬ì—…ê´€ë¦¬íŒ€': [],
                    'ìŠ¤ìº”íŒ€': [],
                    'ì´ë¯¸ì§€ë³´ì •íŒ€': [],
                    'TOCíŒ€': [],
                    'ì ê²€1íŒ€': [],
                    'ì ê²€2íŒ€': [],
                    'ì ê²€3íŒ€': []
                };

                if (workRows.length > 1) {
                    workRows.slice(1).forEach(r => {
                        if (r[0]) workQueues['ì´ë¯¸ì§€ë³´ì •íŒ€'].push(r[0]);
                        if (r[1]) workQueues['TOCíŒ€'].push(r[1]);
                        if (r[2]) workQueues['ì ê²€1íŒ€'].push(r[2]);
                        if (r[3]) workQueues['ì ê²€2íŒ€'].push(r[3]);
                        if (r[4]) workQueues['ì ê²€3íŒ€'].push(r[4]);
                    });
                }

                // 4. íŠ¹ê·¼/ì•¼ê·¼ ì²˜ë¦¬
                specialWork = {};
                if (specialRows.length > 1) {
                    specialRows.slice(1).forEach(r => {
                        const [id, type, start, end] = r;
                        if (id && type) {
                            specialWork[id] = { type, start, end };
                        }
                    });
                }

                dataLoaded = true;
                
                // UI ì—…ë°ì´íŠ¸
                debouncedUpdate();
                
                hideLoading();
                showSuccess("ëª¨ë“  ë°ì´í„° ë¡œë“œ ì™„ë£Œ");

            } catch (err) {
                showError(`ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${err.message}`);
                hideLoading();
                dataLoaded = true;
                debouncedUpdate();
            }
        }

        // ì´ˆê¸°í™”
        function init() {
            updateTime();
            loadAllData();

            // 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
            setInterval(updateTime, 1000);
        }
        
        // ì •ê¸°ì ìœ¼ë¡œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        setInterval(() => {
            if (dataLoaded) {
                console.log("ìë™ ìƒˆë¡œê³ ì¹¨: êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ");
                loadAllData();
            }
        }, CONFIG.refreshInterval);

        // ì»´í¬ë„ŒíŠ¸ ì •ë¦¬
        function cleanup() {
            if (updateTimeout) {
                clearTimeout(updateTimeout);
                updateTimeout = null;
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
            window.removeEventListener('DOMContentLoaded', init);
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', cleanup);

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', init);

        // ë³´ì•ˆ ê´€ë ¨ ì´ë²¤íŠ¸ ì°¨ë‹¨
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => e.preventDefault());
        document.addEventListener('dragstart', e => e.preventDefault());
    </script>
</body>
</html>